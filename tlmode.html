<!DOCTYPE html><html>
<head>
  <title>TL MODE - Fixpoint Search</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body { padding: 20px; }
    .result { background: #f9f9f9; padding: 20px; margin-top: 20px; white-space: pre-wrap; border-left: 4px solid #42a5f5; font-family: monospace; }
    .modal textarea { height: 150px; overflow-y: auto; resize: none; }
    .modal-content textarea.materialize-textarea { height: 150px !important; overflow-y: auto; resize: none; }
    .input-field { margin-top: 20px; margin-bottom: 10px; }
    .btn { margin-top: 15px; margin-bottom: 15px; margin-right: 10px; }
    .right-align { margin-bottom: 20px; }
    .center-align { margin-top: 25px; margin-bottom: 25px; }
    #all-results { max-height: 300px; overflow-y: auto; }
    #all-results h6 { margin-top: 10px; margin-bottom: 5px; }
    #all-results ul { margin-left: 20px; margin-bottom: 10px; }
    #all-results hr { margin-top: 15px; margin-bottom: 15px; border: 0; border-top: 1px solid #ccc; }
    .modal-content h5 { margin-bottom: 20px; }
    .modal-content .input-field { margin-top: 15px; margin-bottom: 15px; }
    .modal-footer a { margin-left: 10px; }
    #login-wrapper { max-width: 400px; margin: 40px auto; }
  </style>
</head>
<body>
  <!-- LOGIN SECTION -->
  <div id="login-wrapper">
    <h5 class="center-align">Login</h5>
    <div class="input-field">
      <input id="login-username" type="text">
      <label for="login-username">Username</label>
    </div>
    <div class="input-field">
      <input id="login-password" type="password">
      <label for="login-password">Password</label>
    </div>
    <div class="center-align">
      <button class="btn green" id="login-button">Login</button>
    </div>
  </div>  <!-- APP UI STARTS -->  <div id="app-wrapper" style="display:none">
    <div class="container">
      <h5 class="center-align">TL MODE EXTRACTOR</h5>
      <div class="right-align">
        <a class="btn-floating btn-large green modal-trigger" href="#add-project-modal">
          <i class="material-icons">add</i>
        </a>
      </div>
      <div class="input-field">
        <select id="project-selector">
          <option value="" disabled selected>Select a saved project</option>
        </select>
        <label for="project-selector">Load Project</label>
      </div>
      <div class="center-align">
        <button class="btn red darken-2" id="delete-project">
          <i class="material-icons left">delete</i>Delete Project
        </button>
      </div>
      <div class="input-field">
        <input id="tech-id" type="text" placeholder="e.g. TECH123">
        <label for="tech-id">Search TECH ID (FIX1_ID)</label>
      </div>
      <div class="center-align">
        <button class="btn blue" id="search-button">
          <i class="material-icons left">search</i>Search
        </button>
        <button class="btn green" id="calculate-all-button">
          <i class="material-icons left">calculate</i>Calculate All
        </button>
        <button class="btn purple darken-2 modal-trigger" href="#multiplier-modal" id="calculate-all-projects-button">
          <i class="material-icons left">grid_on</i>All Projects Total
        </button>
      </div>
      <div class="center-align">
        <button class="btn orange" id="export-button">
          <i class="material-icons left">file_download</i>Download CSV
        </button>
      </div>
      <div id="output" class="result z-depth-1"></div>
      <div id="all-results" class="result z-depth-1"></div><div id="add-project-modal" class="modal">
    <div class="modal-content">
      <h5>Add New Project</h5>
      <div class="input-field">
        <input id="project-name" type="text">
        <label for="project-name">Project Name</label>
      </div>
      <div class="input-field">
        <textarea id="raw-data" class="materialize-textarea" placeholder="Paste your fixpoints data here..."></textarea>
        <label for="raw-data">Fixpoints Data</label>
      </div>
      <div class="row">
        <div class="input-field col s6">
          <select id="modal-size">
            <option value="3in">3IN</option>
            <option value="9in">9IN</option>
          </select>
          <label for="modal-size">Project Size</label>
        </div>
        <div class="input-field col s6">
          <label>
            <input type="checkbox" id="modal-ir-check" />
            <span>IR Multiplier</span>
          </label>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <a href="#!" class="modal-close btn grey">Cancel</a>
      <a href="#!" class="btn green" id="save-project">Save Project</a>
    </div>
  </div>
</div>

  </div>  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>  <script>
    const hardcodedUsername = 'user1';
    const hardcodedPassword = 'pass1';

    const githubConfig = {
      username: 'gmlorenz',
      repo: 'mysave_data',
      token: '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'
    };

    async function uploadToGitHub(filename, content) {
      const url = `https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/${filename}`;
      const encodedContent = btoa(unescape(encodeURIComponent(content)));
      const payload = {
        message: `Save ${filename}`,
        content: encodedContent
      };
      const response = await fetch(url, {
        method: 'PUT',
        headers: {
          'Authorization': `token ${githubConfig.token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
      });
      if (!response.ok) throw new Error(`GitHub upload failed: ${response.status}`);
      return await response.json();
    }

    async function saveProject() {
      const name = document.getElementById('project-name').value.trim();
      const data = document.getElementById('raw-data').value.trim();
      const size = document.getElementById('modal-size').value;
      const ir = document.getElementById('modal-ir-check').checked;

      if (!name || !data) {
        M.toast({ html: 'Please enter a project name and data.', classes: 'red' });
        return;
      }

      const payload = JSON.stringify({ data, size, ir }, null, 2);
      const filePath = `projects/${name}.json`;

      try {
        await uploadToGitHub(filePath, payload);
        M.toast({ html: `Project '${name}' saved to GitHub!`, classes: 'green' });
      } catch (err) {
        M.toast({ html: `Failed to save project: ${err.message}`, classes: 'red' });
        console.error(err);
      }

      const modalElem = document.querySelector('#add-project-modal');
      const modalInstance = M.Modal.getInstance(modalElem);
      modalInstance.close();
      document.getElementById('project-name').value = '';
      document.getElementById('raw-data').value = '';
      document.getElementById('modal-size').value = '3in';
      document.getElementById('modal-ir-check').checked = false;
      M.FormSelect.init(document.getElementById('modal-size'));
      M.updateTextFields();
    }

    document.addEventListener('DOMContentLoaded', function () {
      M.FormSelect.init(document.querySelectorAll('select'));
      M.Modal.init(document.querySelectorAll('.modal'));
      M.updateTextFields();

      document.getElementById('login-button').addEventListener('click', () => {
        const user = document.getElementById('login-username').value.trim();
        const pass = document.getElementById('login-password').value.trim();

        if (user === hardcodedUsername && pass === hardcodedPassword) {
          document.getElementById('login-wrapper').style.display = 'none';
          document.getElementById('app-wrapper').style.display = 'block';

          // Re-init UI & bind save event
          M.FormSelect.init(document.querySelectorAll('select'));
          M.Modal.init(document.querySelectorAll('.modal'));
          M.updateTextFields();

          document.getElementById('save-project').addEventListener('click', saveProject);

          M.toast({ html: 'Login successful!', classes: 'green' });
        } else {
          M.toast({ html: 'Invalid credentials', classes: 'red' });
        }
      });
    });
  </script></body>
</html>
